<div class="invoice-list-container">
  <h2 class="page-title">Invoice List</h2>

  <input class="invoice-search" placeholder="Search by name or phone" [(ngModel)]="searchTerm"
    (ngModelChange)="applyFilter()" />

  <div class="bulk-actions" *ngIf="selectedCount > 0">
    <button class="btn-primary" *ngIf="selectedCount === 1" (click)="openPreview()">View Invoice</button>
    <button class="btn-primary" *ngIf="selectedCount > 1" (click)="exportCsv()">Export CSV</button>
  </div>

  <div class="table-wrapper">
    <table class="invoice-table">
      <thead>
        <tr>
          <th><input type="checkbox" (change)="toggleSelectAll($event)" /></th>
          <th>#</th>
          <th>Client</th>
          <th>Phone</th>
          <th>Total</th>
          <th>Balance</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let inv of paginatedInvoices; let i = index">
          <td><input type="checkbox" [(ngModel)]="inv.selected" (change)="onSelectionChange()" /></td>
          <td>{{ i + 1 }}</td>
          <td>{{ inv.userName }}</td>
          <td>{{ inv.phoneNumber }}</td>
          <td>₹ {{ inv.totalAmount }}</td>
          <td>₹ {{ inv.balanceAmount }}</td>
          <td>{{ inv.createdAt | date:'dd MMM yyyy' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ================= PREVIEW MODAL ================= -->
<div class="modal-backdrop" *ngIf="showPreview">
  <div class="modal">
    <div class="modal-header">
      <h3>Invoice Preview</h3>
      <div class="modal-actions">
        <button class="btn-primary" (click)="downloadPdf()">Download PDF</button>
        <button class="btn-outline" (click)="closePreview()">Close</button>
      </div>
    </div>
    <div id="invoice-pdf" class="invoice-pdf">
      <app-invoice-template [invoice]="selectedInvoice"></app-invoice-template>
    </div>
  </div>
</div>